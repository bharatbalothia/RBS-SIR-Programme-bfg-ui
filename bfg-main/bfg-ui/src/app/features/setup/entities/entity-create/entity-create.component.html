<mat-card class="entity-create-card">
    <mat-card-header>
        <mat-card-title>{{editableEntity ? 'Edit ' + editableEntity.entity + ' entity' : 'Create Entity'}}
        </mat-card-title>
    </mat-card-header>
    <mat-card-content class="card-content">
        <mat-error class="top-error-message" *ngIf="errorMessage">{{errorMessage.message}} ({{errorMessage.code}})
        </mat-error>
        <mat-horizontal-stepper #stepper [linear]="isLinear" (selectionChange)="getSummaryFieldsSource()">
            <mat-step [stepControl]="entityTypeFormGroup">
                <form [formGroup]="entityTypeFormGroup">
                    <ng-template matStepLabel>Choose entity type</ng-template>
                    <mat-form-field>
                        <mat-label>{{entityDisplayNames['service'] || 'service'}}</mat-label>
                        <mat-select formControlName="service" (selectionChange)="onServiceSelect($event.value)"
                            required>
                            <mat-option *ngFor="let service of getEntityServicesArray()" [value]="service">{{service}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngFor="let validation of entityValidationMessages.service">
                            <mat-error class="error-message"
                                *ngIf="entityTypeFormGroup.get('service').hasError(validation.type)">
                                {{validation.message}}</mat-error>
                        </mat-error>
                        <mat-error class="error-message" *ngIf="getErrorByField('service')">
                            {{getErrorByField('service')}}
                        </mat-error>
                    </mat-form-field>
                    <div class='stepper-actions'>
                        <button mat-raised-button matStepperNext class="action-button">Next</button>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="entityPageFormGroup">
                <form [formGroup]="entityPageFormGroup">
                    <ng-template matStepLabel>Complete entity page</ng-template>
                    <mat-form-field>
                        <mat-label>{{entityDisplayNames['entity'] || 'entity'}}</mat-label>
                        <input matInput formControlName="entity" required>
                        <mat-error *ngFor="let validation of entityValidationMessages.entity">
                            <mat-error class="error-message"
                                *ngIf="entityPageFormGroup.get('entity').hasError(validation.type)">
                                {{validation.message}}</mat-error>
                        </mat-error>
                        <mat-error class="error-message" *ngIf="getErrorByField('entity')">
                            {{getErrorByField('entity')}}
                        </mat-error>
                    </mat-form-field>
                    <section class='radio-group-section'>
                        <label
                            class='radio-group-label'>{{entityDisplayNames['routeInbound'] || 'routeInbound'}}:*</label>
                        <mat-radio-group formControlName='routeInbound'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('routeInbound')">
                            {{getErrorByField('routeInbound')}}
                        </mat-error>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['inboundRequestorDN'] || 'inboundRequestorDN'}}</mat-label>
                            <input matInput formControlName="inboundRequestorDN" appInputLowercase required>
                            <mat-error *ngFor="let validation of entityValidationMessages.inboundRequestorDN">
                                <mat-error class="error-message"
                                    *ngIf="entityPageFormGroup.get('inboundRequestorDN').hasError(validation.type)">
                                    {{validation.message}}</mat-error>
                            </mat-error>
                            <mat-error class="error-message" *ngIf="getErrorByField('inboundRequestorDN')">
                                {{getErrorByField('inboundRequestorDN')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <mat-form-field>
                        <mat-label>{{entityDisplayNames['inboundResponderDN'] || 'inboundResponderDN'}}</mat-label>
                        <input matInput formControlName="inboundResponderDN" appInputLowercase required>
                        <mat-error *ngFor="let validation of entityValidationMessages.inboundResponderDN">
                            <mat-error class="error-message"
                                *ngIf="entityPageFormGroup.get('inboundResponderDN').hasError(validation.type)">
                                {{validation.message}}</mat-error>
                        </mat-error>
                        <mat-error class="error-message" *ngIf="getErrorByField('inboundResponderDN')">
                            {{getErrorByField('inboundResponderDN')}}
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{entityDisplayNames['inboundService'] || 'inboundService'}}</mat-label>
                        <input matInput formControlName="inboundService" required>
                        <mat-error *ngFor="let validation of entityValidationMessages.inboundService">
                            <mat-error class="error-message"
                                *ngIf="entityPageFormGroup.get('inboundService').hasError(validation.type)">
                                {{validation.message}}</mat-error>
                        </mat-error>
                        <mat-error class="error-message" *ngIf="getErrorByField('inboundService')">
                            {{getErrorByField('inboundService')}}
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{entityDisplayNames['inboundRequestType'] || 'inboundRequestType'}}</mat-label>
                        <mat-select formControlName="inboundRequestType" multiple>
                            <mat-select-trigger>
                                <mat-chip-list>
                                    <mat-chip
                                        *ngFor="let inboundRequestType of entityPageFormGroup.get('inboundRequestType').value"
                                        [removable]="true" (removed)="onInboundRequestTypeRemoved(inboundRequestType)">
                                        {{ inboundRequestType }}
                                        <mat-icon matChipRemove>cancel</mat-icon>
                                    </mat-chip>
                                </mat-chip-list>
                            </mat-select-trigger>
                            <mat-option *ngFor="let inboundRequestType of inboundRequestTypeList"
                                [value]="inboundRequestType">{{inboundRequestType}}
                            </mat-option>
                        </mat-select>
                        <mat-error class="error-message" *ngIf="getErrorByField('inboundRequestType')">
                            {{getErrorByField('inboundRequestType')}}
                        </mat-error>
                    </mat-form-field>
                    <section class='radio-group-section'>
                        <label class='radio-group-label'>{{entityDisplayNames['inboundDir'] || 'inboundDir'}}:*</label>
                        <mat-radio-group formControlName='inboundDir'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('inboundDir')">
                            {{getErrorByField('inboundDir')}}
                        </mat-error>
                    </section>
                    <section class='radio-group-section'>
                        <label
                            class='radio-group-label'>{{entityDisplayNames['inboundRoutingRule'] || 'inboundRoutingRule'}}:*</label>
                        <mat-radio-group formControlName='inboundRoutingRule'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('inboundRoutingRule')">
                            {{getErrorByField('inboundRoutingRule')}}
                        </mat-error>
                    </section>
                    <div class='stepper-actions'>
                        <button mat-raised-button matStepperPrevious class="action-button">Back</button>
                        <button mat-raised-button matStepperNext class="action-button">Next</button>
                        <button mat-raised-button class="action-button" color='warn' (click)="cancelEntity()">
                            Cancel</button>
                    </div>
                </form>
            </mat-step>
            <mat-step *ngIf="scheduleListFormGroup" [stepControl]="scheduleListFormGroup">
                <form [formGroup]="scheduleListFormGroup">
                    <ng-template matStepLabel>Complete Schedule details</ng-template>
                    <mat-table [dataSource]="scheduleListFormGroup.get('scheduleList').value">
                        <ng-container matColumnDef="action">
                            <mat-header-cell *matHeaderCellDef> Action </mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button mat-icon-button (click)="openScheduleDialog(element)">
                                    <mat-icon inline>edit</mat-icon>
                                </button>
                                <button mat-icon-button *ngIf="!element.entityLog">
                                    <mat-icon>clear</mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="schedule">
                            <mat-header-cell *matHeaderCellDef> Schedule </mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                {{getFormattedSchedule(element)}}
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="scheduleType">
                            <mat-header-cell *matHeaderCellDef> Type </mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                {{element.isWindow ? scheduleType.WINDOW : scheduleType.DAILY}}
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="addSchedule">
                            <mat-footer-cell *matFooterCellDef [attr.colspan]="scheduleDisplayedColumns.length">
                                <button mat-raised-button color="primary" (click)="openScheduleDialog()">
                                    <mat-icon>add</mat-icon> Create a new schedule
                                </button>
                            </mat-footer-cell>
                        </ng-container>
                        <mat-header-row *matHeaderRowDef="scheduleDisplayedColumns"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: scheduleDisplayedColumns;"></mat-row>
                        <mat-footer-row *matFooterRowDef="['addSchedule']">
                        </mat-footer-row>
                    </mat-table>
                    <div class='stepper-actions'>
                        <button mat-raised-button matStepperPrevious class="action-button">Back</button>
                        <button mat-raised-button matStepperNext class="action-button">Next</button>
                        <button mat-raised-button class="action-button" color='warn' (click)="cancelEntity()">
                            Cancel</button>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="SWIFTDetailsFormGroup">
                <form [formGroup]="SWIFTDetailsFormGroup">
                    <ng-template matStepLabel>Complete SWIFT details</ng-template>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['requestorDN'] || 'requestorDN'}}</mat-label>
                            <input matInput formControlName="requestorDN" appInputLowercase required>
                            <mat-error *ngFor="let validation of entityValidationMessages.requestorDN">
                                <mat-error class="error-message"
                                    *ngIf="SWIFTDetailsFormGroup.get('requestorDN').hasError(validation.type)">
                                    {{validation.message}}</mat-error>
                            </mat-error>
                            <mat-error class="error-message" *ngIf="getErrorByField('requestorDN')">
                                {{getErrorByField('requestorDN')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['responderDN'] || 'responderDN'}}</mat-label>
                            <input matInput formControlName="responderDN" appInputLowercase required>
                            <mat-error *ngFor="let validation of entityValidationMessages.responderDN">
                                <mat-error class="error-message"
                                    *ngIf="SWIFTDetailsFormGroup.get('responderDN').hasError(validation.type)">
                                    {{validation.message}}</mat-error>
                            </mat-error>
                            <mat-error class="error-message" *ngIf="getErrorByField('responderDN')">
                                {{getErrorByField('responderDN')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['requestType'] || 'requestType'}}</mat-label>
                            <input matInput formControlName="requestType">
                            <mat-error class="error-message" *ngIf="getErrorByField('requestType')">
                                {{getErrorByField('requestType')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section class='radio-group-section'>
                        <label class='radio-group-label'>{{entityDisplayNames['trace'] || 'trace'}}:</label>
                        <mat-radio-group formControlName='trace'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('trace')">
                            {{getErrorByField('trace')}}
                        </mat-error>
                    </section>
                    <section class='radio-group-section'>
                        <label class='radio-group-label'>{{entityDisplayNames['snF'] || 'snF'}}:</label>
                        <mat-radio-group formControlName='snF'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('snF')">
                            {{getErrorByField('snF')}}
                        </mat-error>
                    </section>
                    <section class='radio-group-section'>
                        <label
                            class='radio-group-label'>{{entityDisplayNames['deliveryNotification'] || 'deliveryNotification'}}:</label>
                        <mat-radio-group formControlName='deliveryNotification'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('deliveryNotification')">
                            {{getErrorByField('deliveryNotification')}}
                        </mat-error>
                    </section>
                    <section class='radio-group-section'>
                        <label
                            class='radio-group-label'>{{entityDisplayNames['nonRepudiation'] || 'nonRepudiation'}}:</label>
                        <mat-radio-group formControlName='nonRepudiation'>
                            <mat-radio-button [value]="true">Yes</mat-radio-button>
                            <mat-radio-button [value]="false">No</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('nonRepudiation')">
                            {{getErrorByField('nonRepudiation')}}
                        </mat-error>
                    </section>
                    <section class='radio-group-section'>
                        <label class='radio-group-label'>{{entityDisplayNames['e2eSigning'] || 'e2eSigning'}}:*</label>
                        <mat-radio-group formControlName='e2eSigning'>
                            <mat-radio-button value="None">None</mat-radio-button>
                            <mat-radio-button value="Crypto">Crypto</mat-radio-button>
                        </mat-radio-group>
                        <mat-error class="error-message" *ngIf="getErrorByField('e2eSigning')">
                            {{getErrorByField('e2eSigning')}}
                        </mat-error>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['deliveryNotifDN'] || 'deliveryNotifDN'}}</mat-label>
                            <input matInput formControlName="deliveryNotifDN">
                            <mat-error class="error-message" *ngIf="getErrorByField('deliveryNotifDN')">
                                {{getErrorByField('deliveryNotifDN')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['deliveryNotifRT'] || 'deliveryNotifRT'}}</mat-label>
                            <input matInput formControlName="deliveryNotifRT">
                            <mat-error class="error-message" *ngIf="getErrorByField('deliveryNotifRT')">
                                {{getErrorByField('deliveryNotifRT')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['requestRef'] || 'requestRef'}}</mat-label>
                            <input matInput formControlName="requestRef">
                            <mat-error class="error-message" *ngIf="getErrorByField('requestRef')">
                                {{getErrorByField('requestRef')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['fileInfo'] || 'fileInfo'}}</mat-label>
                            <input matInput formControlName="fileInfo">
                            <mat-error class="error-message" *ngIf="getErrorByField('fileInfo')">
                                {{getErrorByField('fileInfo')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['fileDesc'] || 'fileDesc'}}</mat-label>
                            <input matInput formControlName="fileDesc">
                            <mat-error class="error-message" *ngIf="getErrorByField('fileDesc')">
                                {{getErrorByField('fileDesc')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['transferInfo'] || 'transferInfo'}}</mat-label>
                            <input matInput formControlName="transferInfo">
                            <mat-error class="error-message" *ngIf="getErrorByField('transferInfo')">
                                {{getErrorByField('transferInfo')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <section>
                        <mat-form-field>
                            <mat-label>{{entityDisplayNames['transferDesc'] || 'transferDesc'}}</mat-label>
                            <input matInput formControlName="transferDesc">
                            <mat-error class="error-message" *ngIf="getErrorByField('transferDesc')">
                                {{getErrorByField('transferDesc')}}
                            </mat-error>
                        </mat-form-field>
                    </section>
                    <div class='stepper-actions'>
                        <button mat-raised-button matStepperPrevious class="action-button">Back</button>
                        <button mat-raised-button matStepperNext class="action-button">Next</button>
                        <button mat-raised-button class="action-button" color='warn' (click)="cancelEntity()">
                            Cancel</button>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="summaryPageFormGroup">
                <form [formGroup]="summaryPageFormGroup">
                    <ng-template matStepLabel>Summary page</ng-template>
                    <mat-table [dataSource]="summaryPageDataSource">
                        <ng-container matColumnDef="field">
                            <mat-header-cell *matHeaderCellDef> Field </mat-header-cell>
                            <mat-cell *matCellDef="let element"> {{entityDisplayNames[element.field] || element.field}}
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="value">
                            <mat-header-cell *matHeaderCellDef> Value </mat-header-cell>
                            <mat-cell *matCellDef="let element"> {{element.value}}
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="error">
                            <mat-header-cell *matHeaderCellDef> Error </mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <mat-error class='error-table-cell'>{{element.error}}</mat-error>
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="changerComment">
                            <mat-footer-cell *matFooterCellDef colspan="2">
                                <mat-form-field>
                                    <mat-label>{{entityDisplayNames['changerComments'] || 'changerComments'}}
                                    </mat-label>
                                    <textarea matInput formControlName="changerComments"></textarea>
                                    <mat-error class="error-message" *ngIf="getErrorByField('changerComments')">
                                        {{getErrorByField('changerComments')}}
                                    </mat-error>
                                </mat-form-field>
                            </mat-footer-cell>
                        </ng-container>
                        <mat-header-row *matHeaderRowDef="summaryDisplayedColumns"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: summaryDisplayedColumns;"></mat-row>
                        <mat-footer-row *matFooterRowDef="['changerComment']; sticky: true"></mat-footer-row>
                    </mat-table>
                    <div class='stepper-actions'>
                        <button mat-raised-button matStepperPrevious class="action-button">Back</button>
                        <button mat-raised-button class="action-button" color='primary'
                            (click)="sendEntity(isEditing())">{{isEditing() ? 'Edit' : 'Create'}}</button>
                        <button mat-raised-button class="action-button" color='warn' (click)="cancelEntity()">
                            Cancel</button>
                    </div>
                </form>
            </mat-step>
        </mat-horizontal-stepper>
    </mat-card-content>
    <mat-card-footer>
        <mat-progress-bar mode="buffer" *ngIf="isLoading"></mat-progress-bar>
    </mat-card-footer>
</mat-card>